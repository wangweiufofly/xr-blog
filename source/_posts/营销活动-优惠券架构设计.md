---
title: 营销活动&优惠券架构设计
date: 2018-11-01 16:31:25
comments: true
tags: 
    - 业务架构
---

[TOC]

## 优惠券的生命周期和设计实现

优惠券作为一种重要营销手段, 每张优惠券的生命周期以下几个链路组成

### 投放

投放是指在创建优惠券之前，需要确定优惠券是投放在哪个渠道，用什么形式投放？会有怎样的成本收益，如何与其他效果差异等等？

把投放放在最前面，是指我们在制券的时候已经对券要投放在哪个渠道有了认识，相当于你要做一个活动，先确定活动的框架，再搭活动中的细节，完成每个事项，然后推动活动上线，最后回收上线数据，前提是你要先确定这次活动的目标和形式。

#### 1、投放渠道

投放渠道分端内和端外，覆盖产品的主要补贴渠道。

<img class="alignnone size-full wp-image-67" src="http://blog.hyfzc.cn/wp-content/uploads/2018/11/优惠券投放渠道.jpg" alt="" width="700" />

<!-- more -->

#### 2、投放形式

##### 1）接口红包
将发券接口封装好提供给其他页面框架，实现发券功能，如领券专区，用户前端点击行为触发后端请求给用户账户放一张券，用户根据意愿领取行为；

##### 2）兑换码
根据优惠码兑换优惠券，有中文和英文字符两种形式，主要用户定向发放给某些用户，需要用户手动输入或复制至兑换处，转化率低；

##### 3）H5领取页
使用最频繁的领券方式，常用于渠道合作，当年满天飞的滴滴红包就是典型的案例，标配模板支持替换头图，读取用户微信昵称，含登录组件，输入手机号码即可领券到账，多用于产品外部环境，用户需要收入手机号码或者登录领取，配合活动

##### 4）绑券
是指运营通过后台将优惠券绑定到某些用户账户的发券方式

##### 5）系统自动触发
天降红包即系统自动触发的一种形式，打开APP行为调起发券请求；还有例如打开滴滴划到代驾页面会收到一张代驾券和短信，饿了么送单迟到后系统自动补偿券等，均是根据一定的规则系统自动触发券的形式，其实也是在发券接口基础上二次开发的机制。


### 优惠券创建

#### 优惠券模型
<img class="alignnone size-full wp-image-65" src="http://blog.hyfzc.cn/wp-content/uploads/2018/11/coupon2.jpg" alt="" width="900"/>

### 优惠券发放

#### 1、发放人群

- **用户属性：**
  新用户、老用户、下单用户、会员等；

- **地理围栏：**
  手动划分的服务区、某个活动商圈或商家、白领集中的CBD区等；

- **用户生命周期：**
  根据用户生命周期标签判断什么用户发什么券，可在发券工具中关联券ID和用户标签，用户标签抽取自标签系统，根据运营需求灵活定义一部分标签用户。也可以在创建券时自定义（历史或近N天)累计订单数和末购时间天数，将判断用户生命周期的特征和属性值设计成自定义模式，这样设计的好处是建券时即可关联符合条件的用户，适用于简单的用户筛选；

- **优惠敏感度：**
  在之前的文章中有介绍过优惠敏感度模型，根据数据模型判断给每个用户打一个敏感值，并划定在什么范围内的属于最敏感，其次是中高敏、中敏、低敏等，建券时选择此项并填写上敏感度值范围即可实现对符合条件的用户发券；

- **流失概率：**
  根据流失预警模型计算出来每个用户流失的概率值，发券时关联一定值范围内的用户即可；

- **补贴率：**
  补贴率主要适用于老用户，根据用户前N天的订单补贴情况来定给用户发什么金额的券，这里提醒下，补贴率=订单抵扣金额/订单原价

- **是否安装竞对APP：**
  出于一定的黑科技，能够判断用户是否安装了竞品APP（我们其实真的活在裸奔的时代），然后给安装竞品的用户发更高额的券，这就和我们在有竞对的城市或竞对比较强的城市实施更有利的用户策略一样；

以上几种用户身份判断均需要额外的数据开发工作，将标签接口化输入到券系统中。

#### 2、外在条件

如天气是否恶劣，实际上天气对大部分业务的影响都很大、节日节气、当地风俗等对订单产生影响的客观因素；

#### 3、发放规则

如账户内有未过期的排斥券则不在发放、账户内有新手券则判断发老用户券、用户要过风控规则等；

#### 4、发放工具

发放工具与投放渠道和投放形式一致：
- 如果投放在渠道合作，则可以选择跳转红包配置后台，红包文案和皮肤配置完成后生产链接或二维码输出；
- 如果投放的是兑换码，则跳转兑换码生成后台，配置完成提供excel下载功能；其他形式亦然，从制券跳转配置发券工具，完成制券到投放的过程；

### 优惠券使用

#### 1、使用规则

使用规则关联的是到账户的券要符合哪些条件才可以使用，有些时候满足发券条件却不满足使用条件，运营需要避免发到用户账户内的券不可使用的情况减少投诉，如用户从2个渠道收到2张新手券，再使用第二张的时候却被告知已不是新用户了，这里就是在使用条件出做了用户身份判断，最好的方式还是让用户的账户内一直保持仅有一张新手券；

#### 2、使用渠道

APP、小程序等渠道；

#### 3、使用时间段

限制早高峰、晚高峰，通过时间段的限制引导用户分散消费，缓解运力或配送的压力；

#### 4、业务模式
限制自营模式使用、限制代理商模式使用；

#### 5、地理围栏
使用城市或区域限制，如出行类业务异地场景需求大，服务仅开了几个城市，但是发券是针对全国发放的，则需要限制哪些城市可用，且需要明确告知用户；

#### 6、用户属性
除了以上针对标签用户发券，用券主要是限制新老用户，避免上述新客领取到多张新手券使用的情况；

以上所有规则在选定以后，系统都需要根据所选项生成相应的文案释义。

### 优惠券使用统计

#### 1、核销状态

发出去的券，有多少张已被使用，多少还未使用，到达一定天数后，运营可以配置是否选择对未使用用户设置短信或push使用提醒；

#### 2、使用和成本统计

发出去多少张，用了多少张，使用率是多少，单均实付，补贴率，订单总体GMV，人均用券张数等维度的统计，不同活跃度的用户用券占比多少，用券失败率多少，共花费了多少预算，时间日期维度的使用曲线是怎样的，运营可以根据所需维度提出需求开发相应统计报表；

## 架构可扩展的定义

- **业务扩展**
变更或新增业务逻辑时, 尽量对已有的核心模块影响最小,保证系统整体的稳定性.

- **性能扩展**
保证系统是可以水平扩展的, 从而具有应对更高的负载能力.

一个系统的稳定性,除了需要由健壮的代码来保证外, 架构上的拆分,也会有相当大的影响.比如:我们将易变的模块(需求变化频繁)和稳定的模块糅合在一起部署的话, 易变模块的变化造成整个系统频繁的部署,就会对整个系统带来极大的风险.所以扩展性在系统设计之初就需要着重考虑.

## 功能和性能需求
从功能和性能需求上对要做的优惠券系统有个整体上的认识, 来看看哪些需求是易变的,哪些需求是稳定的.
### 发券
#### 优惠券活动管理
运营人员根据促销档期和财务计划, 制定优惠券活动的方案,包括:

- **发券方式:** 
  用户主动领取还是被动接收
- **发券内容:** 
  发券的种类, 发券数量, 是否多种券组合发放.
- **促销方式:**
 见下文
- **使用限制:**
见下文
- **通知方式:**
短信通知,邮件通知,app通知

#### 优惠券发券
从瞬时单次发券的用户数量来看, 发券活动分为
- **对单用户发券:**
  用户大促抽奖领券,新用户注册领券,订单完成后返券以及对投诉用户补偿券时会采用这种领券活动.
  从功能上看,对单用户发券的玩法多种多样,属于易变的需求.
  从性能上看,单用户发券请求量较高,同时也非常强调券到账的及时性,在用户发出领券请求后,系统应当尽快将券送达账户.
        
- **对多用户发券:**
从功能上看,在补贴大战,提升交易额以及唤醒沉睡的老用户时会采用,一般会结合短信通知和邮件通知的方式来让用户知晓有券到账. 多用户发券的业务较为稳定,一般是运营人员通过后台选择特定范围内用户列表后触发.
从性能上看,对多用户发券的请求量较小,但发券量比较大,可能一次发放上百万张券到用户,所以多用户发券更强调发券系统的稳定性.

### 用券
#### 促销方式
从券的促销方式来看, 优惠券种类一般有:
- **立减:**
优惠金额固定的优惠券, 比如我们现在的现金券.
- **折扣:**
优惠金额跟订单金额成比例的优惠券, 目前我们这边不需要.
- **其他促销**

不同的优惠券促销方式, 会对应不同的优惠金额计算逻辑.

#### 使用限制
从用户使用角度看, 优惠券还会有多种使用限制:
- **限时间:**
优惠券的有效期
- **限平台**
比如设定一种券只能在微信h5平台上使用
- **限地域**
比如只能在上海使用该优惠券
- **其他限制**

限制逻辑保证了优惠券促销花的钱,都用到了提升对应维度的运营数据上.
### 需求总结
#### 易变的需求
- **对单用户发券的方式(请求量大)**

#### 稳定的需求:
- **发券活动管理(请求量小)**
- **对多用户发券的方式(请求量小)**
- **优惠券的促销方式**
- **优惠券的使用限制**


## 营销活动架构实现

### 营销活动整体架构
<img class="alignnone size-full wp-image-64" src="http://blog.hyfzc.cn/wp-content/uploads/2018/11/营销活动模型.jpg" alt="" width="900" />


#### 优惠券活动平台架构

根据功能与性能需求,我们对优惠券系统模块做以下划分:
<img class="alignnone size-full wp-image-66" src="http://blog.hyfzc.cn/wp-content/uploads/2018/11/优惠券平台架构.jpg" alt="" width="900" />

#### 活动平台

营销活动平台作为营销活动的入口系统，活动系统提供以下API:

- **活动管理API**
提供活动管理的功能，新增，修改，上下架等操作；


#### 优惠券平台

优惠券系统作为核心系统,需要应对极大的访问量. 服务需要水平扩展,优惠券平台提供以下API:

- **优惠券管理API**

    提供优惠券的创建，修改，下架等管理API，供运营人员使用

- **单用户发券API**

- **批量发券API**

    单用户发券API将单用户发券API和批量发券API拆分是因为两个接口的使用场景不太一样:批量发券的发券量非常大,但时效性要求不高, 可以做更多的优化.
    
- **查询优惠券API**

    提供查询所有优惠券和查询订单页可用优惠券的功能。

- **优惠券核销API**

    提供订单下单功能的核销模块。

#### 优惠券数据统计平台
- 通过读取线上优惠券数据的备份,进行数据报表生成的平台, 提供运营数据分析使用.